{"version":3,"sources":["src/AreaHeatmap.js"],"names":["AreaHeatmap","React","Component","e","props","onMouseEnter","onMouseLeave","xScale","yScale","onMouseMove","boundBox","refs","background","getBoundingClientRect","x","y","clientX","left","clientY","top","xVal","yVal","invert","getDomain","data","xEnd","yEnd","map","shouldComponentUpdate","nextProps","shouldUpdate","render","area","scaleWidth","scaleHeight","rectClassName","rectStyle","areaAccessor","xAccessor","xEndAccessor","yAccessor","yEndAccessor","makeAccessor2","unitsPerPixel","Math","max","apply","d","i","abs","handlers","xEndVal","yEndVal","areaVal","getter","fullWidth","fullHeight","fullRectX","min","fullRectY","pixelArea","width","sqrt","height","rectX","rectY","every","val","isFinite","className","style","key","PropTypes","array","isRequired","CustomPropTypes","valueOrAccessor","number","oneOfType","string","func","object"],"mappings":"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","sourcesContent":["import { extent } from 'd3-array';\nimport flatten from 'lodash/flatten';\nimport isFunction from 'lodash/isFunction';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { methodIfFuncProp } from './util.js';\nimport * as CustomPropTypes from './utils/CustomPropTypes';\nimport { getValue, makeAccessor2 } from './utils/Data';\nimport xyPropsEqual from './utils/xyPropsEqual';\n\n/**\n * `AreaHeatmap` is still undergoing experimental changes!\n * We do not consider this chart to be production ready as it does not support categorical data.\n */\n\n// todo support categorical data\n\nexport default class AreaHeatmap extends React.Component {\n  static propTypes = {\n    /**\n     * Array of data objects.\n     */\n    data: PropTypes.array.isRequired,\n    x: CustomPropTypes.valueOrAccessor,\n    xEnd: CustomPropTypes.valueOrAccessor,\n    y: CustomPropTypes.valueOrAccessor,\n    yEnd: CustomPropTypes.valueOrAccessor,\n    area: CustomPropTypes.valueOrAccessor,\n    unitsPerPixel: PropTypes.number,\n    /**\n     * Class attribute to be applied to each rect\n     * or accessor function which returns a class\n     */\n    rectClassName: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n    /**\n     * Inline style object to be applied to each rect,\n     * or accessor function which returns a style object.\n     */\n    rectStyle: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n    /**\n     * D3 scale for X axis - provided by XYPlot\n     */\n    xScale: PropTypes.func,\n    /**\n     * D3 scale for Y axis - provided by XYPlot\n     */\n    yScale: PropTypes.func,\n    onMouseEnter: PropTypes.func,\n    onMouseLeave: PropTypes.func,\n    onMouseMove: PropTypes.func,\n  };\n  static defaultProps = { rectClassName: '', rectStyle: {} };\n\n  static getDomain(props) {\n    const { data, x, xEnd, y, yEnd } = props;\n    return {\n      x: extent(\n        flatten([data.map(makeAccessor2(x)), data.map(makeAccessor2(xEnd))]),\n      ),\n      y: extent(\n        flatten([data.map(makeAccessor2(y)), data.map(makeAccessor2(yEnd))]),\n      ),\n    };\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const shouldUpdate = !xyPropsEqual(this.props, nextProps, ['rectStyle']);\n    return shouldUpdate;\n  }\n\n  onMouseEnter = e => {\n    this.props.onMouseEnter(e);\n  };\n\n  onMouseLeave = e => {\n    this.props.onMouseLeave(e);\n  };\n\n  onMouseMove = e => {\n    const { xScale, yScale, onMouseMove } = this.props;\n    if (!isFunction(onMouseMove)) return;\n\n    const boundBox = this.refs.background.getBoundingClientRect();\n    if (!boundBox) return;\n    const [x, y] = [\n      e.clientX - (boundBox.left || 0),\n      e.clientY - (boundBox.top || 0),\n    ];\n    const [xVal, yVal] = [xScale.invert(x), yScale.invert(y)];\n\n    onMouseMove(e, { xVal, yVal });\n  };\n\n  render() {\n    const {\n      data,\n      area,\n      x,\n      xEnd,\n      y,\n      yEnd,\n      xScale,\n      yScale,\n      scaleWidth,\n      scaleHeight,\n      rectClassName,\n      rectStyle,\n    } = this.props;\n    const [areaAccessor, xAccessor, xEndAccessor, yAccessor, yEndAccessor] = [\n      area,\n      x,\n      xEnd,\n      y,\n      yEnd,\n    ].map(makeAccessor2);\n\n    // to determine how many data units are represented by 1 square pixel of area,\n    // find the bin that would require the highest unit-per-pixel scale if its rectangle filled the whole container\n    const unitsPerPixel =\n      this.props.unitsPerPixel ||\n      Math.max.apply(\n        this,\n        data.map((d, i) => {\n          // ratio of this bin's area (in data units) to the entire area of its container rectangle (in pixels)\n          return (\n            getValue(area, d, i) /\n            Math.abs(\n              (xScale(getValue(xEnd, d, i)) - xScale(getValue(x, d, i))) *\n                (yScale(getValue(yEnd, d, i)) - yScale(getValue(y, d, i))),\n            )\n          );\n        }),\n      );\n\n    const handlers = {\n      onMouseMove: methodIfFuncProp('onMouseMove', this.props, this),\n      onMouseEnter: methodIfFuncProp('onMouseEnter', this.props, this),\n      onMouseLeave: methodIfFuncProp('onMouseLeave', this.props, this),\n    };\n\n    return (\n      <g className=\"rct-area-heatmap-chart\" aria-hidden=\"true\" {...handlers}>\n        <rect\n          x=\"0\"\n          y=\"0\"\n          width={scaleWidth}\n          height={scaleHeight}\n          ref=\"background\"\n          fill=\"transparent\"\n        />\n        {data.map((d, i) => {\n          const [xVal, xEndVal, yVal, yEndVal, areaVal] = [\n            x,\n            xEnd,\n            y,\n            yEnd,\n            area,\n          ].map(getter => getValue(getter, d, i));\n          // full width and height of the containing rectangle\n          const fullWidth = Math.abs(xScale(xEndVal) - xScale(xVal));\n          const fullHeight = Math.abs(yScale(yEndVal) - yScale(yVal));\n          // x / y position of top left of the containing rectangle\n          const fullRectX = Math.min(xScale(xEndVal), xScale(xVal));\n          const fullRectY = Math.min(yScale(yEndVal), yScale(yVal));\n\n          // we know two facts:\n          // 1. the (pixel) area of the rect will be the data value divided by the # of data units per pixel\n          //    ie. area = height * width = areaVal / unitsPerPixel\n          const pixelArea = areaVal / unitsPerPixel;\n          // 2. all rectangles, regardless of size, have the same shape (are congruent), so the ratio\n          //    of the rect's width to the full width is equal to the ratio of its height to the full height.\n          //    ie. (height / fullHeight) = (width / fullWidth)\n          // solve for height and width to get...\n          const width = Math.sqrt(pixelArea * (fullWidth / fullHeight));\n          const height = Math.sqrt(pixelArea * (fullHeight / fullWidth));\n\n          // center the data rect in the containing rectangle\n          const rectX = fullRectX + (fullWidth - width) / 2;\n          const rectY = fullRectY + (fullHeight - height) / 2;\n\n          if (\n            ![rectX, rectY, width, height].every(\n              val => val !== null && isFinite(val),\n            )\n          )\n            return null;\n\n          const className = `rct-area-heatmap-rect ${getValue(\n            rectClassName,\n            d,\n            i,\n          )}`;\n          const style = getValue(rectStyle, d, i);\n          const key = `rect-${i}`;\n\n          return (\n            <rect\n              {...{ x: rectX, y: rectY, width, height, className, style, key }}\n            />\n          );\n        })}\n      </g>\n    );\n  }\n}\n"],"file":"AreaHeatmap.js"}